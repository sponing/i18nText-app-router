- [简体中文](README.md)
- [English](README-en.md)
Here is the translated guide to set up internationalization in Next.js 14 using `i18next`, both for App Router and Page Router:

## Next.js 14 Template

### App Route

Example: [App Route I18n Example](https://github.com/vercel/next.js/tree/canary/examples/app-dir-i18n-routing)

The configuration for App Router is relatively more complex compared to Page Router, but following the steps below will help you avoid many pitfalls!

### Step-by-Step Guide for App Router

1. **Install Dependencies**

   ```bash
   pnpm install i18next accept-language i18next-resources-to-backend react-i18next
   ```

2. **Change Project Path**

   Move `page.tsx` and `layout.tsx` under `app/[lng]`.

3. **Create Configuration File**

   Create a configuration file at `app/lib/i18n/setting.js`.

   ```javascript
   export const fallbackLng = 'en';
   export const languages = [fallbackLng, 'it'];
   export const defaultNS = 'translation';

   export function getOptions(lng = fallbackLng, ns = defaultNS) {
     return {
       // debug: true,
       supportedLngs: languages,
       fallbackLng,
       lng,
       fallbackNS: defaultNS,
       defaultNS,
       ns,
     };
   }
   ```

4. **Create Hook File**

   Create `app/lib/i18n/index.js` to define hooks and where to read translation files from.

   ```javascript
   import { createInstance } from 'i18next';
   import resourcesToBackend from 'i18next-resources-to-backend';
   import { initReactI18next } from 'react-i18next/initReactI18next';
   import { getOptions } from './settings';

   const initI18next = async (lng, ns) => {
     const i18nInstance = createInstance();
     await i18nInstance
       .use(initReactI18next)
       .use(resourcesToBackend((language, namespace) => import(`../../../public/locales/${language}/${namespace}.json`)))
       .init(getOptions(lng, ns));
     return i18nInstance;
   };

   export async function useTranslation(lng, ns, options = {}) {
     const i18nextInstance = await initI18next(lng, ns);
     return {
       t: i18nextInstance.getFixedT(lng, Array.isArray(ns) ? ns[0] : ns, options.keyPrefix),
       i18n: i18nextInstance,
     };
   }
   ```

5. **Redirect Based on Request Headers**

   Create `middleware.js` in the root directory.

   ```javascript
   import { NextResponse } from 'next/server';
   import acceptLanguage from 'accept-language';
   import { fallbackLng, languages } from './settings';

   acceptLanguage.languages(languages);

   export const config = {
     matcher: ['/((?!api|_next/static|_next/image|assets|favicon.ico|sw.js).*)'],
   };

   export function middleware(req) {
     const lng = acceptLanguage.get(req.headers.get('Accept-Language')) || fallbackLng;
     if (!languages.some(loc => req.nextUrl.pathname.startsWith(`/${loc}`)) && !req.nextUrl.pathname.startsWith('/_next')) {
       return NextResponse.redirect(new URL(`/${lng}${req.nextUrl.pathname}`, req.url));
     }
     return NextResponse.next();
   }
   ```

6. **Inject `lng` Attribute in `layout.tsx`**

   ```javascript
   import { Inter } from "next/font/google";
   import { dir } from 'i18next';
   import { languages, fallbackLng } from '../../lib/i18n/locales/setting';
   import "./globals.css";

   export async function generateStaticParams() {
     return languages.map((lng) => ({ lng }));
   }

   const inter = Inter({ subsets: ["latin"] });

   export const metadata = {
     title: "Create Next App",
     description: "Generated by create next app",
   };

   export default function RootLayout({ children, lng }) {
     return (
       <html lang={lng} dir={dir(lng || fallbackLng)}>
         <body className={inter.className}>{children}</body>
       </html>
     );
   }
   ```

### Usage Example

Similar to the Page Router solution, place translation files under `public/locales`.

```javascript
// page.tsx
import { useTranslation } from '../lib/i18n/index';

export default async function Page({ params: { lng } }) {
  const { t } = await useTranslation(lng, 'common');
  return (
    <>
      <div>{t('title')}</div>
      <div>{t('main.text')}</div>
    </>
  );
}
```

### Page Router

To handle internationalization in Next.js 14 using the `i18ntext` library, follow these steps to create an `i18n` configuration file and set up middleware.

### 1. Install Dependencies

First, install `i18next`, `next-i18next`, and `react-i18next`:

```bash
npm install i18next next-i18next react-i18next
yarn add i18next next-i18next react-i18next
```

### 2. Create `i18n` Configuration File

Create a `next-i18next.config.js` file in the root directory of the project:

#### `next-i18next.config.js`

```javascript
const lang = ['en-US', 'zh-CN'];
module.exports = {
  i18n: {
    locales: ["default", ...lang],
    defaultLocale: "en-US",
  },
  localePath: './locales',
};
```

### Advanced Configuration

```javascript
const lang = ['en-US', 'zh-CN'];
module.exports = {
  i18n: {
    locales: [...lang],
    defaultLocale: "zh-CN",
  },
  localeExtension: "json", // Language file extension
  defaultNS: "common", // Default namespace
  localePath: "./locales", // Path to language files
  reloadOnPrerender: false, // Do not reload language files during server-side rendering
  strictMode: true, // Enable strict mode
  nsMode: "zh-CN", // Use zh-CN as namespace mode
  use: [], // Do not use any plugins
  supportedLngs: [...lang], // Supported languages
};
```

### 3. Configure `next.config.js`

Update `next.config.js` to use `next-i18next` configuration:

#### `next.config.mjs`

```javascript
import { createRequire } from 'module';
const require = createRequire(import.meta.url);
const { i18n } = require('./next-i18next.config');

const nextConfig = {
  i18n,
  reactStrictMode: true,
};

export default nextConfig;
```

#### `next.config.js`

```javascript
const { i18n } = require('./next-i18next.config');

module.exports = {
  reactStrictMode: true,
  i18n,
};
```

### 4. Create Localization Folder and Translation Files

Create a `locales` folder in the `public` directory, and within it, create language folders (e.g., `en` and `zh`), then create translation JSON files.

#### File Structure

```
locales/
  ├── en-US/
  │   └── common.json
  │   └── header.json
  └── zh-CN/
      └── common.json
      └── header.json
```

#### Example Translation File `common.json`

##### `locales/en-US/common.json`

```json
{
  "welcome": "Welcome"
}
```

##### `locales/zh-CN/common.json`

```json
{
  "welcome": "欢迎"
}
```

##### `locales/en-US/header.json`

```json
{
  "title": "title"
}
```

##### `locales/zh-CN/header.json`

```json
{
  "title": "标题"
}
```

### 5. Initialize `next-i18next`

Create `_app.js` file and initialize `next-i18next` in it.

#### `pages/_app.js`

```javascript
import { appWithTranslation } from 'next-i18next';
import '../styles/globals.css';

function MyApp({ Component, pageProps }) {
  return <Component {...pageProps} />;
}

export default appWithTranslation(MyApp);
```

### 6. Use `i18ntext` for Translation

Use the `useTranslation` hook in the page component for translation.

#### Example Page Component

##### `pages/index.js`

```javascript
import { useTranslation } from 'next-i18next';
import { serverSideTranslations } from 'next-i18next/serverSideTranslations';

export default function Home() {
  const { t } = useTranslation('common');
  // You can also handle it this way
  const { t: tHeader } = useTranslation('header');

  return (
    <div>
      <h1>{t('welcome')}</h1>
      <h1>{t('title', { ns: 'header' })}</h1>
      // You can also handle it this way
      <h1>{tHeader('header')}</h1>
    </div>
  );
}

export async function getStaticProps({ locale }) {
  return {
    // If you need to load header translations, add header here
    props: {
      ...(await serverSideTranslations(locale, ['common', 'header'])),
    },
  };
}
```

### 7

. Configure Internationalization Middleware (Optional)

You can configure internationalization middleware in `next.config.js` to automatically detect user language:

#### Update `next.config.js`

```javascript
const { i18n } = require('./next-i18next.config');

module.exports = {
  reactStrictMode: true,
  i18n,
  async redirects() {
    return [
      {
        source: '/',
        destination: '/en',
        permanent: false,
      },
      {
        source: '/zh',
        destination: '/zh',
        permanent: false,
      },
    ];
  },
};
```

### Summary

By following these steps, you can use the `i18ntext` library for internationalization in a Next.js 14 project. Configure `next-i18next` to manage translation files, and use the `useTranslation` hook in your page components for translation. This way, you can easily manage and switch between multiple language versions of your content. [Learn More](https://juejin.cn/post/7331577745107861554#heading-1)